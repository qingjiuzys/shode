# Shode v0.8.0 Release Notes

**Release Date**: TBD

## Overview

v0.8.0 represents a major milestone with the introduction of three major feature sets:

1. **Middleware System** - Priority-based middleware framework for HTTP request processing
2. **Code Refactoring** - Significant code quality improvements with 50-80% reduction in function complexity
3. **Database ORM** - Comprehensive database abstraction layer with query builder and transaction support

## What's New

### ðŸš€ Middleware System

A flexible, priority-based middleware framework for HTTP request processing.

**Features:**
- Chain-of-responsibility pattern with priority ordering
- Skip conditions for conditional execution
- Built-in middleware suite with 5 production-ready middlewares
- Easy integration with stdlib HTTP server

**Built-in Middlewares:**

| Middleware | Description | Use Case |
|------------|-------------|----------|
| **CORS** | Cross-origin resource sharing | Web APIs with browser clients |
| **Rate Limiting** | Token bucket algorithm | API protection, DDoS prevention |
| **Logging** | Request/response logging | Debugging, analytics |
| **Recovery** | Panic recovery | Graceful error handling |
| **Request ID** | Distributed tracing | Microservices, debugging |

**Usage Example:**
```go
// Use middleware in stdlib
sl.UseMiddleware("cors")
sl.UseMiddleware("rate_limit")
sl.UseMiddleware("logging")

// List active middlewares
middlewares := sl.ListMiddlewares()

// Remove middleware
sl.RemoveMiddleware("rate_limit")
```

**Test Coverage:** 90.5% (35 test cases)

### ðŸ”§ Code Refactoring

Major improvements to code maintainability and testability.

**Refactored Functions:**

| Function | Before | After | Improvement |
|----------|--------|-------|-------------|
| `serveStaticFile` | 100 lines | 50 lines | 50% reduction |
| `Execute` | 412 lines | 80 lines | 80% reduction |

**Benefits:**
- Easier to understand and maintain
- Better test coverage
- Clear separation of concerns
- Reduced cognitive load

### ðŸ’¾ Database ORM

Comprehensive database abstraction layer with support for PostgreSQL, MySQL, and SQLite.

**Core Features:**
- **CRUD Operations**: Create, Read, Update, Delete with model interface
- **Query Builder**: Fluent interface for complex queries
- **Transaction Support**: ACID transactions with auto-rollback
- **Multiple Databases**: PostgreSQL, MySQL, SQLite support

**Model Example:**
```go
type User struct {
    ID    int64  `db:"id" auto_incr:"true"`
    Name  string `db:"name"`
    Email string `db:"email"`
}

func (u *User) TableName() string { return "users" }
func (u *User) PrimaryKey() string { return "id" }
func (u *User) PrimaryKeyValue() interface{} { return u.ID }
```

**Query Builder Example:**
```go
users, err := orm.QueryBuilder("users").
    Where("age > $1", 18).
    WhereIn("status", []interface{}{"active", "pending"}).
    OrderBy("created_at DESC").
    Limit(10).
    All(ctx)
```

**Transaction Example:**
```go
err := orm.Transaction(ctx, func(tx *database.Tx) error {
    if err := tx.Create(ctx, user); err != nil {
        return err // Auto-rollback
    }
    if err := tx.Create(ctx, profile); err != nil {
        return err // Auto-rollback
    }
    return nil // Auto-commit
})
```

## Migration Guide

### Using Middleware

```go
// Before: No middleware
sl.StartHTTPServer("8080")

// After: With middleware
sl.UseMiddleware("request_id")  // Priority 50
sl.UseMiddleware("cors")        // Priority 100
sl.UseMiddleware("rate_limit")  // Priority 200
sl.UseMiddleware("logging")     // Priority 300
sl.UseMiddleware("recovery")    // Priority 10 (highest priority)

sl.StartHTTPServer("8080")
```

### Using Database ORM

```go
// Connect to database
orm, err := database.OpenSQLite("./mydb.db")
if err != nil {
    log.Fatal(err)
}
defer orm.Close()

// Create record
user := &User{Name: "John", Email: "john@example.com"}
if err := orm.Create(ctx, user); err != nil {
    log.Fatal(err)
}

// Query records
users, err := orm.Find(ctx, &User{}, "age > $1", 18)
```

## Breaking Changes

None. This release is fully backward compatible.

## Dependencies

### Added
- `github.com/google/uuid` - UUID generation for Request ID middleware

### Updated
- `go.mod` - Added database driver imports (sqlite3, postgres, mysql)

## Performance

- Middleware overhead: < 1ms per request
- ORM reflection overhead: < 0.5ms per operation
- Query builder compilation: < 1Î¼s

## Documentation

- [CHANGELOG.md](../CHANGELOG.md) - Full changelog
- [pkg/middleware/](../pkg/middleware/) - Middleware package documentation
- [pkg/database/](../pkg/database/) - Database ORM documentation

## Contributors

- [@your-username] - Architecture and implementation
- Claude Sonnet 4.5 - Code generation and testing

## Next Steps

See [ROADMAP.md](../ROADMAP.md) for planned features in v0.9.0 and beyond.

## Links

- [GitHub Repository](https://github.com/your-org/shode)
- [Issue Tracker](https://github.com/your-org/shode/issues)
- [Documentation](https://shode.dev/docs)
